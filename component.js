!function(){"use strict";let e="insightcubes-hierarchy-multiselect";class t extends HTMLElement{VIEW_STATES={VS_DEFAULT:"VS_DEFAULT",VS_DISPLAY_TREE:"VS_DISPLAY_TREE",VS_ITEMS_SELECTED:"VS_ITEMS_SELECTED"};CURRENT_VIEW_STATE="VS_DEFAULT";EVENTS={ON_CONNECTED:"onConnected",ON_DISCONNECTED:"onDisconnected",ON_INITIALIZED:"onInitialized",ON_READY:"onReady",ON_SELECTION_CLEARED:"onSelectionCleared",ON_ITEM_CHECKED:"onItemChecked",ON_ITEM_UNCHECKED:"onItemUnchecked",ON_ITEMS_CONFIRMED:"onItemsConfirmed",ON_NODE_EXPANDED:"onNodeExpanded",ON_NODE_COLLAPSED:"onNodeCollapsed"};debugEnabled=!1;displayMessage="";displaySelection=!1;items={};items_processed=[];lastCheckedItemId="";lastUncheckedItemId="";selectedItemIds=[];expandedNodeIds=new Set();nodesExpandedByDefault=false;constructor(){super(),this.defineProps(),this.attachShadow({mode:"open"}).appendChild(this.getTemplate()),this.log(this.EVENTS.ON_READY),this.dispatchEvent(new CustomEvent(this.EVENTS.ON_READY,{cancelable:!1,bubbles:!0,composed:!0})),this.log(this.EVENTS.ON_INITIALIZED),this.dispatchEvent(new CustomEvent(this.EVENTS.ON_INITIALIZED,{cancelable:!1,bubbles:!0,composed:!0})),this.setViewState(this.VIEW_STATES.VS_DEFAULT),this.log("initialized")}defineProps(){this.sacWidgetName=void 0,this.sacDesignMode=void 0,this.sacMobileMode=void 0,this._props={}}onCustomWidgetBeforeUpdate(e){this._props={...this._props,...e};if(e.hasOwnProperty("nodesExpandedByDefault")){this.nodesExpandedByDefault=!!e.nodesExpandedByDefault;this.initializeExpandedNodes();this.render();}}onCustomWidgetAfterUpdate(e){}connectedCallback(){this.log(this.EVENTS.ON_CONNECTED),this.dispatchEvent(new CustomEvent(this.EVENTS.ON_CONNECTED,{cancelable:!1,bubbles:!0,composed:!0}))}onCustomWidgetDestroy(){this.log("onCustomWidgetDestroy")}disconnectedCallback(){this.log(this.EVENTS.ON_DISCONNECTED),this.dispatchEvent(new CustomEvent(this.EVENTS.ON_DISCONNECTED,{cancelable:!1,bubbles:!0,composed:!0}))}onCustomWidgetResize(){}getTemplate(){let e=document.createElement("template"),t=(new Date).getFullYear();return e.innerHTML=`\n                <style>\n                    :host {\n                        display: block;\n                        padding: 10px;\n                        overflow-y: auto;\n                        font-family: "lato";\n                        font-size: 12px;\n                    }\n\n                    /* ============================== notice within body */\n\n                    div.notice{\n                        padding: 10px 0px;\n                        text-align: left;\n                        font-size: 120%;\n                        font-weight: bold;\n                    }\n\n                    /* ============================== .itemlist */\n\n                    div.itemlist{}\n                  \n                    .itemlist .item{\n                        padding: 5px;\n                        /* cursor: pointer; */\n                        display: flex;\n                        align-items: center;\n                    }\n                \n                    .itemlist .item:hover, .itemlist .item.selected{\n                        background-color: rgba(221, 221, 221, 0.3);\n                    }\n                \n                    .itemlist .item .name{\n                        font-weight: bold;\n                    }\n\n                    .iqcc--listitem{\n                        padding: 10px;\n                    }\n\n                    div.item--selected {\n                        font-weight: bold;\n                    }\n\n                    /* ============================== header */\n\n                    #section--header{\n                        text-align: left;\n                        color: #888;\n                        margin-top: 0.25rem;\n                        font-size: 65%;\n                        font-weight: bold;\n                        margin-bottom: 0.5rem;\n                    }\n\n                    #section--header a{\n                        color: #39489d;\n                        text-decoration: none;\n                    }\n\n                    /* ============================== controls */\n\n                    #section--controls{\n                        padding: 0.5rem 0;\n                    }\n\n                    /* ============================== status */\n\n                    #section--status{\n                        text-align: left;\n                        color: #888;\n                        font-size: 80%;\n                    }\n\n                    /* ============================== buttons */\n\n                    .btn--base{\n                        padding: 0.5rem;\n                        vertical-align: top;\n                        border: 1px solid #ababab;\n                        border-radius: 0.2rem;\n                        outline: 0;\n\n                        background-color: rgb(247, 247, 247);\n                        border-color: rgb(191, 191, 191);\n                        color: rgb(52, 97, 135);\n                        cursor: pointer;\n                    }\n\n                    .btn--base:hover{\n                        background-color: rgb(219, 215, 215);\n                    }\n                    
                    /* ============================== expand/collapse icons */\n                    
                    .expand-collapse-icon {\n                        display: inline-block;\n                        width: 16px;\n                        height: 16px;\n                        margin-right: 5px;\n                        cursor: pointer;\n                        position: relative;\n                        font-size: 10px;\n                        color: #555;\n                        text-align: center;\n                        line-height: 16px;\n                    }\n                    
                    .expand-collapse-icon.expanded::after {\n                        content: '▼';\n                    }\n                    
                    .expand-collapse-icon.collapsed::after {\n                        content: '▶';\n                    }\n                    
                    .no-children {\n                        width: 16px;\n                        height: 16px;\n                        margin-right: 5px;\n                        display: inline-block;\n                    }\n                    
                    .node-container {\n                        display: flex;\n                        flex-direction: column;\n                        width: 100%;\n                    }\n                    
                    .node-children {\n                        display: block;\n                        overflow: hidden;\n                        transition: max-height 0.3s ease;\n                    }\n                    
                    .node-children.collapsed {\n                        max-height: 0;\n                        display: none;\n                    }\n                    
                    .node-children.expanded {\n                        max-height: 1000px;\n                        display: block;\n                    }\n                </style>\n\n                <div>\n                    <div id="section--header">\n                        &copy; ${t} <a href="https://insightcubes.com" target="_blank">Insight Cubes</a>\n                    </div>\n\n                    <div id="section--status"></div>\n                    <div id="section--controls"></div>\n\n                    <div id="section--body">\n                        <div class="notice">Loading</div>\n                    </div>\n                </div>\n            `,e.content.cloneNode(!0)}log(...t){this.debugEnabled&&console.log("["+e+"] ",...t)}getCurrentViewState(){return this.CURRENT_VIEW_STATE||(this.CURRENT_VIEW_STATE=this.VIEW_STATES.VS_DEFAULT),this.CURRENT_VIEW_STATE}setViewState(e){"string"==typeof e&&Object.keys(this.VIEW_STATES).includes(e)||this.log("attempted to set invalid view state: ",e);let t=this.CURRENT_VIEW_STATE;t===e?this.log("view state rerender:",this.CURRENT_VIEW_STATE):(this.CURRENT_VIEW_STATE=e,this.log("view state change:",t,"to",this.CURRENT_VIEW_STATE)),this.render()}setDebugEnabled(e){this.debugEnabled=!!e,this.render()}setDisplayMessage(e){this.displayMessage="string"==typeof e?e:"",this.render()}setDisplaySelection(e){this.displaySelection=!!e,this.render()}setNodesExpandedByDefault(e){this.nodesExpandedByDefault=!!e;this.initializeExpandedNodes();this.render()}clearItems(){this.items={},this.items_processed=[],this.expandedNodeIds.clear(),this.log("items cleared"),this.hasSelection()?this.clearSelection():this.setViewState(this.VIEW_STATES.VS_DEFAULT)}addItem(e,t,s="",i=!1,n=!1){if("string"!=typeof e||e.length<1)return this.log("[addItem] invalid id"),!1;if("string"!=typeof t||t.length<1)return this.log("[addItem] invalid name"),!1;"string"==typeof s&&s||(s="");let d={id:e,name:t,parentId:s||"",selectable:!0===i,selected:!0===n};return d.id in this.items?(this.log(`[addItem] item with id=${d.id} already exists`),!1):(this.items[d.id]=d,d.selected&&d.selectable&&(this.isItemIdSelected(d.id)||this.selectedItemIds.push(d.id)),this.items_processed.length&&(this.processItems(),this.initializeExpandedNodes(),this.render()),!0)}dataReady(){return this.processItems(),this.initializeExpandedNodes(),this.items_processed.length>0&&(this.setViewState(this.VIEW_STATES.VS_DISPLAY_TREE),this.log(`dataReady (${Object.keys(this.items).length} items)`),!0)}hasSelection(){return this.selectedItemIds.length>0}clearSelection(){this.hasSelection()?(this.selectedItemIds=[],this.dispatchEvent(new CustomEvent(this.EVENTS.ON_SELECTION_CLEARED,{cancelable:!1,bubbles:!0,composed:!0})),this.items_processed.length>0?this.setViewState(this.VIEW_STATES.VS_DISPLAY_TREE):this.setViewState(this.VIEW_STATES.VS_DEFAULT)):this.log("! no selection to clear")}toggleSelection(e,t){if("string"!=typeof e||e.length<1)return this.log("[setSelection] invalid id"),!1;if(!(e in this.items))return this.log(`[setSelection] id=${e} does not exist`),!1;if(!this.items[e].selectable)return this.log(`[setSelection] id=${e} is not selectable`),!1;if(!0===t){if(!this.isItemIdSelected(e))return this.selectedItemIds.push(e),this.lastCheckedItemId=e,this.dispatchEvent(new CustomEvent(this.EVENTS.ON_ITEM_CHECKED,{cancelable:!1,bubbles:!0,composed:!0})),this.render(),!0}else if(!1===t&&this.isItemIdSelected(e)){let t=this.selectedItemIds.indexOf(e);if(t>=0)return this.selectedItemIds.splice(t,1),this.lastUncheckedItemId=e,this.dispatchEvent(new CustomEvent(this.EVENTS.ON_ITEM_UNCHECKED,{cancelable:!1,bubbles:!0,composed:!0})),this.render(),!0}return!1}getSelectedIds(){return this.selectedItemIds}isItemIdSelected(e){return this.selectedItemIds.indexOf(e)>=0}processItems(){this.items_processed=this.getItemHierarchy()}getItemHierarchy(e="",t=0){if(!this.items||this.items.length<1)return[];let s=[];for(let i in this.items)this.items[i].parentId===e&&(this.items[i].level=t,this.items[i].children=this.getItemHierarchy(i,t+1),s.push(this.items[i]));return s.sort(((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)),s}isNodeExpanded(nodeId){return this.expandedNodeIds.has(nodeId)}toggleNodeExpansion(nodeId, iconElement){const isExpanded = this.isNodeExpanded(nodeId);if (isExpanded) {this.expandedNodeIds.delete(nodeId);this.dispatchEvent(new CustomEvent(this.EVENTS.ON_NODE_COLLAPSED, {detail: { nodeId },cancelable: false,bubbles: true,composed: true}));} else {this.expandedNodeIds.add(nodeId);this.dispatchEvent(new CustomEvent(this.EVENTS.ON_NODE_EXPANDED, {detail: { nodeId },cancelable: false,bubbles: true,composed: true}));}this.render();}initializeExpandedNodes(){this.expandedNodeIds.clear();if (this.nodesExpandedByDefault) {this.expandAllParentNodes();} else {for (const item of this.items_processed) {if (item.level === 0) {this.expandedNodeIds.add(item.id);}}}this.render();}expandAllParentNodes(){this.expandedNodeIds.clear();for (const item of this.items_processed) {if (this.hasChildren(item)) {this.expandedNodeIds.add(item.id);}}}hasChildren(item){return item.children && item.children.length > 0;}getHierarchyDomElements(e,t=[]){const fragment = document.createDocumentFragment();for (let item of e) {let itemContainer = document.createElement("div");itemContainer.className = "node-container";let itemElement = document.createElement("div");itemElement.setAttribute("data-id", item.id);itemElement.setAttribute("data-level", item.level);itemElement.setAttribute("style", `margin-left: ${20 * item.level}px;`);itemElement.className = this.isItemIdSelected(item.id) ? "item selected" : "item";if (item.children && item.children.length) {let expandCollapseIcon = document.createElement("div");expandCollapseIcon.className = "expand-collapse-icon " + (this.isNodeExpanded(item.id) ? "expanded" : "collapsed");expandCollapseIcon.setAttribute("data-id", item.id);let self = this;expandCollapseIcon.addEventListener("click", function(e) {e.stopPropagation();self.toggleNodeExpansion(item.id, this);});itemElement.appendChild(expandCollapseIcon);} else {let noChildrenPlaceholder = document.createElement("div");noChildrenPlaceholder.className = "no-children";itemElement.appendChild(noChildrenPlaceholder);}if (item.selectable) {let checkbox = document.createElement("input");checkbox.setAttribute("type", "checkbox");checkbox.setAttribute("name", `${item.id}`);checkbox.setAttribute("data-id", item.id);if (this.isItemIdSelected(item.id)) {checkbox.setAttribute("checked", "true");} else {checkbox.removeAttribute("checked");}checkbox.setAttribute("value", "true");let self = this;checkbox.addEventListener("change", function() {self.handleItemCheckboxChanged(this);});itemElement.appendChild(checkbox);}let nameElement = document.createElement("span");nameElement.className = "name--value";nameElement.innerHTML = item.name;itemElement.appendChild(nameElement);itemContainer.appendChild(itemElement);if (item.children && item.children.length) {let childrenContainer = document.createElement("div");childrenContainer.className = "node-children " + (this.isNodeExpanded(item.id) ? "expanded" : "collapsed");this.getHierarchyDomElements(item.children, []).forEach(childElement => {childrenContainer.appendChild(childElement);});itemContainer.appendChild(childrenContainer);}fragment.appendChild(itemContainer);t.push(itemContainer);}return t;}handleItemCheckboxChanged(e){let t=e.getAttribute("data-id"),s=e.checked;t&&t in this.items&&this.items[t].selectable&&(s?this.handleItemChecked(t):this.handleItemUnChecked(t))}handleItemChecked(e){return this.log("checked ",e),e in this.items&&(!this.isItemIdSelected(e)&&(this.items[e].selected=!0,this.lastCheckedItemId=e,this.selectedItemIds.push(e),this.dispatchEvent(new CustomEvent(this.EVENTS.ON_ITEM_CHECKED,{cancelable:!1,bubbles:!0,composed:!0})),!0))}handleItemUnChecked(e){if(this.log("unchecked ",e),!(e in this.items))return!1;if(!this.isItemIdSelected(e))return!1;let t=this.selectedItemIds.indexOf(e);return!(t<0)&&(this.items[e].selected=!1,this.lastUncheckedItemId=e,this.selectedItemIds.splice(t,1),this.dispatchEvent(new CustomEvent(this.EVENTS.ON_ITEM_UNCHECKED,{cancelable:!1,bubbles:!0,composed:!0})),!0)}handleSelectionConfirmed(){this.displaySelection&&(this.dispatchEvent(new CustomEvent(this.EVENTS.ON_ITEMS_CONFIRMED,{cancelable:!1,bubbles:!0,composed:!0})),this.setViewState(this.VIEW_STATES.VS_ITEMS_SELECTED))}render(){switch(this.prerender(),this.CURRENT_VIEW_STATE){case this.VIEW_STATES.VS_DEFAULT:this.render_VS_DEFAULT();break;case this.VIEW_STATES.VS_DISPLAY_TREE:this.render_VS_DISPLAY_TREE();break;case this.VIEW_STATES.VS_ITEMS_SELECTED:if(!this.hasSelection())return this.items_processed.length>0?this.setViewState(this.VIEW_STATES.VS_DISPLAY_TREE):this.setViewState(this.VIEW_STATES.VS_DEFAULT);this.render_VS_ITEMS_SELECTED();break;default:this.render_STATE_DEFAULT()}this.postrender()}prerender(){this.getBodyElement().innerHTML="",this.updateStatus(),this.getControlsElement().innerHTML=""}postrender(){}render_VS_DEFAULT(){let e=this.getBodyElement();this.displayMessage&&(e.innerHTML=`<div class="notice">${this.displayMessage}</div>`)}render_VS_DISPLAY_TREE(){let e=this.getBodyElement();this.displayMessage&&(e.innerHTML=`<div class="notice">${this.displayMessage}</div>`);let t=this.getHierarchyDomElements(this.items_processed,[]),s=document.createElement("div");s.className="itemlist";for(let e of t)s.appendChild(e);if(e.appendChild(s),this.displaySelection){let e=document.createElement("button");e.className="btn--base",e.innerHTML="Confirm Selection",e.addEventListener("click",()=>{this.log("Button clicked: Confirm Selection"),this.handleSelectionConfirmed()}),this.getControlsElement().appendChild(e)}}render_VS_ITEMS_SELECTED(){let e=this.getBodyElement();this.displayMessage&&(e.innerHTML=`<div class="notice">${this.displayMessage}</div>`);let t=this.getSelectedIds();for(let s of t){let t=document.createElement("div");t.className="item--selected",t.innerHTML=`${this.items[s].name}`,e.appendChild(t)}let s=document.createElement("button");s.className="btn--base",s.innerHTML="Change Selection",s.addEventListener("click",()=>{this.log("Button clicked: Change Selection"),this.setViewState(this.VIEW_STATES.VS_DISPLAY_TREE)}),this.getControlsElement().appendChild(s)}getBodyElement(){return this.shadowRoot.getElementById("section--body")}getControlsElement(){return this.shadowRoot.getElementById("section--controls")}clearBodyElement(){let e=this.getBodyElement();e&&(e.innerHTML="")}updateStatus(){if(!this.debugEnabled)return;let e=this.shadowRoot.getElementById("section--status");e&&(e.innerHTML=`DEBUG: ${this.CURRENT_VIEW_STATE} `)}getSampleData(){return[{id:"1",pid:null,name:"Item 1",selectable:!1,selected:!1},{id:"1.1",pid:"1",name:"Item 1.1",selectable:!1,selected:!1},{id:"1.1.1",pid:"1.1",name:"Item 1.1.1",selectable:!0,selected:!1},{id:"1.1.2",pid:"1.1",name:"Item 1.1.2",selectable:!0,selected:!0},{id:"1.2",pid:"1",name:"Item 1.2",selectable:!1,selected:!1},{id:"1.2.1",pid:"1.2",name:"Item 1.2.1",selectable:!0,selected:!1},{id:"1.2.2",pid:"1.2",name:"Item 1.2.2",selectable:!0,selected:!1},{id:"2",pid:null,name:"Item 2",selectable:!1,selected:!1},{id:"2.1",pid:"2",name:"Item 2.1",selectable:!0,selected:!1},{id:"2.1.1",pid:"2.1",name:"Item 2.1.1",selectable:!1,selected:!1},{id:"2.1.1.1",pid:"2.1.1",name:"Item 2.1.1.1",selectable:!0,selected:!0}]}}customElements.define(e,t)}();
